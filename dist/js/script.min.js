"use strict";function testWebP(e){var t=new Image;t.onload=t.onerror=function(){e(2==t.height)},t.src="data:image/webp;base64,UklGRjoAAABXRUJQVlA4IC4AAACyAgCdASoCAAIALmk0mk0iIiIiIgBoSygABc6WWgAA/veff/0PP8bA//LwYAAA"}function displayHint(e){document.querySelector(".hint__"+e).style.display="block"}function hideHint(e){document.querySelector(".hint__"+e).style.display="none"}function checkboxChecked(e){let t=document.querySelectorAll(".music__radio");document.querySelector("#checkbox-music").checked?(console.log("Выбран"),t.forEach(e=>e.removeAttribute("disabled"))):(t.forEach(e=>{e.disabled=!0}),console.log("Не Выбран"))}testWebP((function(e){1==e?document.querySelector("body").classList.add("webp"):document.querySelector("body").classList.add("no-webp")}));const startBtn=document.querySelector(".game-area__button");startBtn.y=20;const gameArea=document.querySelector(".game-area"),leftSide=document.querySelector(".left-side");let title=document.querySelector(".game__title"),titleWord=title.querySelector(".title__word"),titleWords=title.querySelectorAll(".title__word");const userName=document.querySelector(".input__user-name");let carWidth,carHeight,windowHeight=document.documentElement.clientHeight;const playerYStart=80*document.documentElement.clientHeight/100,playerXStart=.5*gameArea.offsetWidth;let enemies=[];class Car{constructor(e,t,...a){this.imgSrc=e,this.speed=t,this.classes=[...a]}create(e,t){this.car=document.createElement("img"),gameArea.appendChild(this.car),this.classes.forEach(e=>this.car.classList.add(e)),this.car.src=this.imgSrc,this.car.dataset.xElem=e,this.car.dataset.yElem=t,this.render(),this.car.classList.contains("enemy")&&enemies.push(this.car)}render(){this.car.style.left=this.car.dataset.xElem+"px",this.car.style.top=this.car.dataset.yElem+"px"}}let player=new Car("../img/player.png",0,"car");player.move=function(e){keys.ArrowLeft&&this.car.dataset.xElem>-3&&(this.car.dataset.xElem=+this.car.dataset.xElem-this.speed/2,this.car.style.transform="rotate(-10deg)"),keys.ArrowRight&&this.car.dataset.xElem<gameArea.offsetWidth-this.car.offsetWidth+1&&(this.car.dataset.xElem=+this.car.dataset.xElem+this.speed/2,this.car.style.transform="rotate(10deg)"),(!keys.ArrowRight&&!keys.ArrowLeft||this.car.dataset.xElem<=-1||this.car.dataset.xElem>=gameArea.offsetWidth-this.car.offsetWidth+1)&&(this.car.style.transform="rotate(0deg)"),this.render()};let enemy=new Car("../img/enemy1.png",2,"enemy","car");const keys={ArrowUp:!1,ArrowDown:!1,ArrowRight:!1,ArrowLeft:!1},gameSetting={play:!1,score:0,speed:4,boost:2,enemies:!0,traffic:3};function random(e,t){return e=Math.ceil(e),t=Math.floor(t),Math.floor(Math.random()*(t-e+1))+e}function getMenuValues(){userName.value||(userName.value="player"),player.name=userName.value.capitalize(),userName.disabled="true"}function createRoadMarks(){for(let e=0;e<6;e++){const t=document.createElement("div");t.classList.add("road-mark"),t.style.height=windowHeight/15+"px",t.yElem=e*(4*windowHeight/20),t.style.top=t.yElem+"px",gameArea.appendChild(t)}}function timeToStart(){titleWords.forEach(e=>e.innerText=""),title.style.fontSize="6rem",title.classList.remove("hide"),titleWord.innerHTML="3",setTimeout(()=>{titleWord.innerHTML="2"},1e3),setTimeout(()=>{titleWord.innerHTML="1"},2e3)}function prepareToStart(){getMenuValues(),createRoadMarks(),createPlayer(),player.speed=gameSetting.speed,player.traffic=gameSetting.traffic}function createPlayer(){player.create(playerXStart,playerYStart),player.car.dataset.xElem=player.car.dataset.xElem-player.car.offsetWidth/2,player.render(),carWidth=document.querySelector(".car").offsetWidth,carHeight=document.querySelector(".car").offsetHeight}function removeStartBtn(){startBtn.y>=document.documentElement.clientHeight||!startBtn?startBtn.remove():(startBtn.y+=player.speed,startBtn.style.top=startBtn.y+"px",requestAnimationFrame(removeStartBtn))}function stopGame(){gameSetting.play=!1}function initGame(){startBtn.style.height=startBtn.offsetHeight+"px",startBtn.innerHTML="",prepareToStart(),startGame()}function restartGame(){enemies.forEach(e=>{e.remove()}),enemies=[],player.car.remove(),createPlayer(),console.log(player.car),console.log(player),startGame()}function startGame(){timeToStart(),setTimeout(()=>{title.classList.add("hide"),gameSetting.play=!0,createEnemies(0),requestAnimationFrame(removeStartBtn),requestAnimationFrame(playGame)},3e3)}function createEnemies(e){for(let t=e;t<player.traffic;t++)enemy.create(random(0,gameArea.offsetWidth-carWidth),3*(t+1)*-150)}startBtn.addEventListener("click",initGame),String.prototype.capitalize=function(){return this.charAt(0).toUpperCase()+this.slice(1)};let boostDelta=0,boostStop=!1;function startBoost(e){switch(e.preventDefault(),keys[e.key]=!0,e.keyCode){case 38:if(e.repeat)break;boostStop=!1,requestAnimationFrame((function e(){boostDelta+=.01,player.speed+=.01,boostDelta>=gameSetting.boost||1==boostStop||requestAnimationFrame(e)}));break;case 40:if(e.repeat)break;boostStop=!1,requestAnimationFrame((function e(){boostDelta-=.01,player.speed-=.01,boostDelta<=-1*gameSetting.boost+1||1==boostStop||requestAnimationFrame(e)}))}}function stopBoost(e){switch(e.preventDefault(),keys[e.key]=!1,e.keyCode){case 38:if(e.repeat)break;boostStop=!0,requestAnimationFrame((function e(){boostDelta-=.01,player.speed-=.01,boostDelta<=0?player.speed=Math.round(player.speed):requestAnimationFrame(e)}));break;case 40:if(e.repeat)break;boostStop=!0,requestAnimationFrame((function e(){boostDelta+=.01,player.speed+=.01,boostDelta>=0?player.speed=Math.round(player.speed):requestAnimationFrame(e)}))}}function moveRoad(){document.querySelectorAll(".road-mark").forEach((function(e){e.yElem+=player.speed,e.style.top=e.yElem+"px",e.yElem>=document.documentElement.clientHeight&&(e.yElem=-(3*windowHeight/20+35))}))}function moveEnemy(e){for(let t=0;t<enemies.length;t++)enemies[t].dataset.yElem=+enemies[t].dataset.yElem+player.speed-enemy.speed,enemies[t].style.top=enemies[t].dataset.yElem+"px",+enemies[t].dataset.yElem>=document.documentElement.clientHeight&&enemyRepeat(enemies,t,e)}function playGame(){if(gameSetting.play){document.addEventListener("keydown",startBoost),document.addEventListener("keyup",stopBoost),player.move(),moveRoad();let e=0;enemies.length<player.traffic&&(createEnemies(enemies.length),console.log("добавили"),checkCarPossibility(enemies,enemies.length-1,e)),moveEnemy(e),checkRoadAccident(enemies),requestAnimationFrame(playGame)}}function checkCarPossibility(e,t,a){e[t].dataset.yElem=random(-400,0)-350,e[t].dataset.xElem=random(0,gameArea.offsetWidth-carWidth);let r=getArrayEnemiesChoords(e).x.some(a=>e[t].dataset.xElem>a-carWidth-10&&e[t].dataset.xElem<a+carWidth+10),o=getArrayEnemiesChoords(e).y.some(a=>e[t].dataset.yElem>a-carHeight-15&&e[t].dataset.yElem<a+carHeight+15);return r&&o?5===(a+=1)?(e[t].remove(),void e.splice(t,1)):void checkCarPossibility(e,t,a):(e[t].style.top=e[t].dataset.yElem+"px",void(e[t].style.left=e[t].dataset.xElem+"px"))}function getArrayEnemiesChoords(e){let t={x:[],y:[]};return e.forEach(e=>{+e.dataset.yElem<document.documentElement.clientHeight&&(t.x.push(e.getBoundingClientRect().x-leftSide.offsetWidth),t.y.push(e.getBoundingClientRect().y))}),t}function enemyRepeat(e,t,a){if(e.length>player.traffic)return e[t].remove(),void e.splice(t,1);checkCarPossibility(e,t,a)}function checkRoadAccident(e){for(let t=0;t<e.length;t++)+player.car.dataset.yElem<=e[t].getBoundingClientRect().y+carHeight&&+player.car.dataset.yElem+carHeight>=e[t].getBoundingClientRect().y&&player.car.dataset.xElem<=e[t].getBoundingClientRect().x-leftSide.offsetWidth+carWidth&&+player.car.dataset.xElem>=e[t].getBoundingClientRect().x-leftSide.offsetWidth-carWidth&&(title.classList.remove("hide"),titleWord.innerHTML="Авария!",stopGame(),setTimeout(restartGame,2e3))}